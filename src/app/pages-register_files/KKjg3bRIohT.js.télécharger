;/*FB_PKG_DELIM*/

__d("WAWebMexJoinNewsletterJobMutation.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"newsletter_id"}],b=[{alias:null,args:[{kind:"Variable",name:"newsletter_id",variableName:"newsletter_id"}],concreteType:"XWA2NewsletterMutationResponse",kind:"LinkedField",name:"xwa2_newsletter_join_v2",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,concreteType:"XWA2NewsletterState",kind:"LinkedField",name:"newsletter_state",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"WAWebMexJoinNewsletterJobMutation",selections:b,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"WAWebMexJoinNewsletterJobMutation",selections:b},params:{id:"9926858900719341",metadata:{},name:"WAWebMexJoinNewsletterJobMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("WAWebMexJoinNewsletterJob",["WALogger","WAWebMexClient","WAWebMexJoinNewsletterJobMutation.graphql","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MEX][NEWSLETTER] joined newsletter via mex"]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=h!==void 0?h:h=b("WAWebMexJoinNewsletterJobMutation.graphql");a={newsletter_id:a};c=(yield d("WAWebMexClient").fetchQuery(c,a));d("WALogger").DEV(i()).tags("GQL","MEX").devConsole({response:c});return c});return j.apply(this,arguments)}g.mexJoinNewsletter=a}),98);
__d("WAWebNewsletterSubscribeQueryJob",["WAWebBackendErrors","WAWebMexJoinNewsletterJob","WAWebMexUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h(a)}function h(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebMexUtils").runWithErrorHandler(function(){return d("WAWebMexJoinNewsletterJob").mexJoinNewsletter(a)},d("WAWebMexUtils").MexSupportedFeature.Newsletter));if((b==null?void 0:b.xwa2_newsletter_join_v2)!=null){b=b.xwa2_newsletter_join_v2.newsletter_state.type;if(b==="DELETED"||b==="NON_EXISTING")throw new(d("WAWebBackendErrors").ServerStatusCodeError)(404,"newsletter-deleted-or-non-existing");else if(b==="SUSPENDED")throw new(d("WAWebBackendErrors").ServerStatusCodeError)(423,"newsletter-suspended");return!0}throw new(d("WAWebBackendErrors").ServerStatusCodeError)(500,"unexpected-null-mex-response")});return i.apply(this,arguments)}g.subscribeToNewsletter=a}),98);
__d("WAWebNewsletterSubscribeJob",["WAJobOrchestratorTypes","WAWebNewsletterSubscribeQueryJob","WAWebOrchestratorNonPersistedJob"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("subscribeToNewsletter",function(){return d("WAWebNewsletterSubscribeQueryJob").subscribeToNewsletter(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}g.subscribeToNewsletter=a}),98);
__d("WAWebNewsletterAddOnsUtils",["WAWebNewsletterReactionCollection"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebNewsletterReactionCollection").NewsletterMessageReactionsCollection.get(a.id)}a.key="reactions";var h=[a];function b(a){return a.reduce(function(a,b){h.forEach(function(c){var d=c(b);d!=null&&a[c.key].push(d)});return a},{reactions:[]})}g.getAddOnsFromMessages=b}),98);
__d("WAWebStoreNewsletterMessageAddOns",["Promise","WAJobOrchestratorTypes","WAWebNewsletterAddOnsUtils","WAWebNewsletterReactionUtils","WAWebOrchestratorNonPersistedJob","WAWebdbCRUDOperationsNewsletterReaction","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h,i={reactions:function(a){a=a.map(d("WAWebNewsletterReactionUtils").mapFrontendReactionToBackend);return d("WAWebdbCRUDOperationsNewsletterReaction").createOrUpdateNewsletterReactions(a)}};function a(a){var c=d("WAWebNewsletterAddOnsUtils").getAddOnsFromMessages(a);return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("storeNewsletterMessageAddOns",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=Object.entries(c).map(function(a){a=a[0];var b=i[a];a=c[a];return b(a)});yield (h||(h=b("Promise"))).all(a)}),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}g.storeNewsletterMessageAddOns=a}),98);
__d("WAWebNewsletterSubscribeAction",["fbt","WAJids","WALogger","WAQplTypes","WAWebCommonNewsletterEnums","WAWebCommonNewsletterStrings","WAWebCreateChat","WAWebMsgDataFromModel","WAWebName.react","WAWebNewsletterAttributionLogging","WAWebNewsletterBackendQueues","WAWebNewsletterBridgeApi","WAWebNewsletterGatingUtils","WAWebNewsletterGetMyAddOnsJob","WAWebNewsletterMetadataJob","WAWebNewsletterPullMessagesFromServerAction","WAWebNewsletterStorageUtils","WAWebNewsletterSubscribeJob","WAWebNewsletterUpdateMsgsRecordsJob","WAWebNewsletterUpdateNewslettersRecordsJob","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","WAWebStoreNewsletterMessageAddOns","WAWebToast.react","WAWebToastManager","WAWebWamEnumChannelEventType","asyncToGeneratorRuntime","react"],(function(a,b,c,d,e,f,g,h){var i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletters][subscribeToNewsletterFromMetadataAction] End"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletters][subscribeToNewsletterFromMetadataAction] Start"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletters][subscribeToNewsletterAction] Failed to subscribe"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletters][subscribeToNewsletterAction] End"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletters][subscribeToNewsletterAction] called with a non-newsletter chat"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletters][subscribeToNewsletterAction] Start"]);o=function(){return a};return a}var p=i||c("react"),q=5e3;function r(a,c){var e=c.eventSurface,f=c.similarChannelSessionId,g=c.eventUnit,h=c.entryPoint,i=d("WAWebNewsletterGatingUtils").isNewsletterQPLLoggingEnabled()?d("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.CHANNEL_FOLLOW):null;i==null?void 0:i.annotate({"int":{surface:e,unit:g}});return d("WAWebNewsletterBackendQueues").newsletterSubscribeQueue.enqueue(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").DEV(o());var b=a.newsletterMetadata;if(!a.isNewsletter||b==null){i==null?void 0:i.end(d("WAQplTypes").QuickLogActionType.ABORTED);d("WALogger").ERROR(n()).tags("newsletter").devConsole(a).sendLogs("subscribe-to-not-a-newsletter");return}d("WAWebNewsletterAttributionLogging").NewsletterCoreEventLogger.log({cid:a.id,eventSurface:e,eventUnit:g,channelCoreEventType:d("WAWebWamEnumChannelEventType").CHANNEL_EVENT_TYPE.FOLLOW,similarChannelSessionId:f,entryPoint:h});var c=d("WAJids").toNewsletterJid(a.id.toJid());try{var j;yield d("WAWebNewsletterSubscribeJob").subscribeToNewsletter(c);a.t=(j=(j=a.msgs.last())==null?void 0:j.t)!=null?j:b.creationTime;if(d("WAWebNewsletterGatingUtils").isSimilarNewsletterInThreadEnabled()){(j=a.newsletterMetadata)==null?void 0:j.set("recentlyFollowedFrom",e)}b.membershipType=d("WAWebCommonNewsletterEnums").NewsletterMembershipType.Subscriber;yield d("WAWebNewsletterMetadataJob").updateNewsletterMetadata(d("WAWebNewsletterStorageUtils").createNewsletterMetadataObjectForStorage(b));yield d("WAWebNewsletterUpdateMsgsRecordsJob").addNewsletterMsgsRecords(a.msgs.map(d("WAWebMsgDataFromModel").msgDataFromMsgModel));d("WAWebNewsletterGatingUtils").isNewsletterReactionEnabled()&&(yield d("WAWebNewsletterGetMyAddOnsJob").getMyNewsletterAddOnsJob({count:q,newsletterJid:c}),yield d("WAWebStoreNewsletterMessageAddOns").storeNewsletterMessageAddOns(a.msgs.toArray()));yield d("WAWebNewsletterUpdateNewslettersRecordsJob").updateNewsletterChatRecords([d("WAWebCreateChat").createNewsletterObjectForStorage(a)]);yield d("WAWebNewsletterBridgeApi").NewsletterBridgeApi.subscribeToNewsletter({newsletter:a});d("WALogger").DEV(m());i==null?void 0:i.end(d("WAQplTypes").QuickLogActionType.SUCCESS)}catch(a){i==null?void 0:i.end(d("WAQplTypes").QuickLogActionType.FAIL);d("WALogger").ERROR(l()).tags("newsletter").devConsole(c).sendLogs("newsletter-failed-to-subscribe");throw a}}))}function s(a){d("WAWebToastManager").ToastManager.open(p.jsx(d("WAWebToast.react").Toast,{msg:a}))}function a(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{yield r(a,b),s(h._("__JHASH__Ns9vsB5qLKW__JHASH__",[h._param("channel_name",p.jsx(d("WAWebName.react").Name,{chat:a}))]))}catch(a){if(a.status===419)s(h._("__JHASH__AdNHbaMdnAM__JHASH__"));else if(a.status===405)s(h._("__JHASH__rQRnNfMcCoI__JHASH__"));else if(a.status===451){b=(yield d("WAWebCommonNewsletterStrings").getGeosuspendedInYourCountryString());s(b)}else s(h._("__JHASH__Dx4642GUarW__JHASH__"))}});return t.apply(this,arguments)}function e(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").DEV(k());var c=a.newsletterMetadata;(c==null?void 0:c.isPreview)===!0&&(a.msgs.length===0&&(yield d("WAWebNewsletterPullMessagesFromServerAction").pullNewsletterMessagesFromServer(a,{messageCount:1})),yield r(a,b));d("WALogger").DEV(j())});return u.apply(this,arguments)}g.subscribeToNewsletterAction=r;g.subscribeToNewsletter=a;g.subscribeToDirectoryNewsletter=e}),226);
__d("WAWebUnfollowNewsletterConfirmationModal.react",["fbt","WAWebActionToast.react","WAWebConfirmPopup.react","WAWebFbtCommon","WAWebModalManager","WAWebName.react","WAWebNewsletterUnsubscribeAction","WAWebToast.react","WAWebToastManager","WAWebWDSText.react","react"],(function(a,b,c,d,e,f,g,h){var i,j;b=j||d("react");var k=i||(i=c("react")),l=b.useCallback,m=b.useState;function a(a){var b=a.chat,e=a.loggingOptions,f=a.onClose;a=m(!1);var g=a[0],i=a[1],j=l(function(){d("WAWebModalManager").ModalManager.close(),f==null?void 0:f()},[f]),n=l(function(){var a=d("WAWebActionToast.react").genId();d("WAWebToastManager").ToastManager.open(k.jsx(d("WAWebToast.react").Toast,{msg:h._("__JHASH__EWJ9bJy3Khv__JHASH__"),id:a}))},[]);a=l(function(){i(!0),d("WAWebNewsletterUnsubscribeAction").unsubscribeFromNewsletterAction(b,babelHelpers["extends"]({deleteLocalModels:!1},e))["catch"](function(){n()})["finally"](function(){j(),i(!1)})},[b,e,n,j]);return k.jsx(d("WAWebConfirmPopup.react").ConfirmPopup,{onOK:a,okText:c("WAWebFbtCommon")("Unfollow"),okDisabled:g,cancelDisabled:g,okSpinner:g,onCancel:j,children:k.jsx(d("WAWebWDSText.react").WDSTextTitle,{children:h._("__JHASH__pOi9OvUmUUu__JHASH__",[h._param("channel_name",k.jsx(d("WAWebName.react").Name,{chat:b,titlify:!0}))])})})}a.displayName=a.name+" [from "+f.id+"]";g.UnfollowNewsletterConfirmationModal=a}),226);
__d("WAWebNewsletterQuickFollowButton.react",["fbt","WAWebFlex.react","WAWebModalManager","WAWebNewsletterSubscribeAction","WAWebNewsletterUnsubscribeAction","WAWebSpinner.react","WAWebUnfollowNewsletterConfirmationModal.react","WAWebUnstyledButton.react","WAWebWDSText.react","react","useWAWebUnmountSignal"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j;b=j||d("react");var k=i||(i=c("react")),l=b.useCallback,m=b.useState,n={followButton:{boxSizing:"x9f619",height:"xc9qbxq",$$css:!0}};function a(a){var b=a.confirmUnfollow,e=a.following,f=a.loggingOptions,g=a.newsletter,i=a.onFollowAction,j=a.onFollowSuccess,o=a.onUnfollowAction;a=m(!1);var p=a[0],q=a[1],r=c("useWAWebUnmountSignal")(),s=l(function(){r.aborted||q(!1)},[r.aborted]);a=function(a){a.preventDefault();a.stopPropagation();q(!0);if(!e){i==null?void 0:i();d("WAWebNewsletterSubscribeAction").subscribeToDirectoryNewsletter(g,babelHelpers["extends"]({},f)).then(function(){return j==null?void 0:j()})["finally"](s);return}o==null?void 0:o();if(b){d("WAWebModalManager").ModalManager.open(k.jsx(d("WAWebUnfollowNewsletterConfirmationModal.react").UnfollowNewsletterConfirmationModal,{chat:g,loggingOptions:f,onClose:s}));return}d("WAWebNewsletterUnsubscribeAction").unsubscribeFromNewsletterAction(g,babelHelpers["extends"]({deleteLocalModels:!1},f))["finally"](s)};var t=e?h._("__JHASH__q2OJx1NjUKp__JHASH__"):h._("__JHASH__fwxpTAEyfpc__JHASH__");return k.jsx(c("WAWebUnstyledButton.react"),{onClick:a,xstyle:n.followButton,children:k.jsx(d("WAWebFlex.react").FlexRow,{align:"center",justify:"center",children:p?k.jsx(d("WAWebSpinner.react").Spinner,{color:"highlight",size:16}):k.jsx(d("WAWebWDSText.react").WDSTextSectionTitle,{color:e?"secondary":"teal",children:t})})})}a.displayName=a.name+" [from "+f.id+"]";g.NewsletterQuickFollowButton=a}),226);
__d("WAWebNewsletterLoggingContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext({similarNewsletterSessionId:null,entryPoint:null});g["default"]=b}),98);
__d("WAWebNewsletterChatItem.react",["WAWebDetailImage.react","WAWebFlex.react","WAWebUISpacing","WAWebWDSText.react","react","stylex","useWAWebModelValues"],(function(a,b,c,d,e,f,g){var h,i,j=h||c("react"),k=64,l={container:{width:"xni59qk",minHeight:"x1aes4zu",cursor:"x1ypdohk",$$css:!0},text:{width:"xni59qk",minHeight:"xisnujt",textAlign:"x2b8uid",overflowX:"x6ikm8r",overflowY:"x10wlt62",breakWord:"x9hmgtc",textWrap:"x9wz5kn",$$css:!0}};function a(a){a=a.newsletter;var b=d("useWAWebModelValues").useOptionalModelValues(a.newsletterMetadata,["name","inviteCode","verified"]);return b==null?null:j.jsxs(d("WAWebFlex.react").FlexColumn,{align:"center",xstyle:l.container,children:[j.jsx(d("WAWebDetailImage.react").DetailImage,{id:a.id,size:k,checkmarkIcon:(b==null?void 0:b.verified)===!0?"chat-list":null,showOutline:!0}),j.jsx("div",{className:(i||(i=c("stylex")))(l.text,d("WAWebUISpacing").uiMargin.top8),children:j.jsx(d("WAWebWDSText.react").WDSTextSmall,{color:"primary",textWrap:"ellipsis",children:b==null?void 0:b.name})})]})}a.displayName=a.name+" [from "+f.id+"]";g.NewsletterChatItem=a}),98);
__d("WAWebNewsletterRecommendedV2Item.react",["WAWebBaseShimmerComponents.react","WAWebChatEntryPoint","WAWebFlex.react","WAWebKeyboardHotKeys.react","WAWebNewsletterAttributionLogging","WAWebNewsletterChatItem.react","WAWebNewsletterLoggingContext","WAWebNewsletterQuickFollowButton.react","WAWebOpenNewsletterPreviewChat","WAWebUISpacing","react","stylex","useWAWebEventTargetValue","useWAWebModelValues"],(function(a,b,c,d,e,f,g){var h,i,j;e=j||d("react");var k=h||(h=c("react")),l=e.useCallback,m=e.useContext,n={root:{borderTopStartRadius:"xfh8nwu",borderTopEndRadius:"xoqspk4",borderBottomEndRadius:"x12v9rci",borderBottomStartRadius:"x138vmkv",borderTopColor:"xog00wb",borderEndColor:"x1pspupu",borderBottomColor:"xk1krjo",borderStartColor:"x1tdnxt6",borderTopWidth:"x178xt8z",borderEndWidth:"xm81vs4",borderBottomWidth:"xso031l",borderStartWidth:"xy80clv",borderTopStyle:"x13fuv20",borderEndStyle:"xu3j5b3",borderBottomStyle:"x1q0q8m5",borderStartStyle:"x26u7qi",boxSizing:"x9f619",width:"xj35x94",$$css:!0}};function o(a){var b=a.children;a=a.onClick;return k.jsx(d("WAWebKeyboardHotKeys.react").HotKeys,{role:"button",onClick:a,children:k.jsx(d("WAWebFlex.react").FlexColumn,{align:"center",testid:void 0,className:(i||(i=c("stylex")))(n.root,d("WAWebUISpacing").uiPadding.top12,d("WAWebUISpacing").uiPadding.horiz8,d("WAWebUISpacing").uiPadding.bottom8),children:b})})}o.displayName=o.name+" [from "+f.id+"]";function a(a){var b=a.chatEntryPoint,e=a.eventSurface,f=a.newsletter;a=a.onFollow;var g=d("useWAWebModelValues").useModelValues(f,["newsletterMetadata"]),h=g.newsletterMetadata;g=c("useWAWebEventTargetValue")(d("useWAWebModelValues").useOptionalModelValues(h,["isSubscribedOrOwned"]),["isSubscribedOrOwned"],function(){return(h==null?void 0:h.isSubscribedOrOwned)===!0});var i=m(c("WAWebNewsletterLoggingContext")),j=i.similarNewsletterSessionId,n=i.entryPoint;i=i.eventUnit;var p=l(function(){b===d("WAWebChatEntryPoint").ChatEntryPoint.SimilarNewsletters&&d("WAWebNewsletterAttributionLogging").NewsletterCoreEventLogger.setSimilarChannelsSessionId(j),d("WAWebOpenNewsletterPreviewChat").openNewsletterPreviewChat(f.id.toString(),b)},[f,b,j]);e={eventSurface:e,similarChannelSessionId:j,entryPoint:n,eventUnit:i};return k.jsxs(o,{onClick:p,children:[k.jsx(d("WAWebNewsletterChatItem.react").NewsletterChatItem,{newsletter:f}),k.jsx(d("WAWebNewsletterQuickFollowButton.react").NewsletterQuickFollowButton,{confirmUnfollow:!1,onFollowSuccess:a,following:g,loggingOptions:e,newsletter:f})]})}a.displayName=a.name+" [from "+f.id+"]";function b(){return k.jsxs(o,{children:[k.jsx(d("WAWebBaseShimmerComponents.react").CircleShimmer,{diameter:64,xstyle:d("WAWebUISpacing").uiMargin.bottom8}),k.jsx(d("WAWebBaseShimmerComponents.react").RectangleShimmer,{height:20,width:96,xstyle:d("WAWebUISpacing").uiMargin.bottom16}),k.jsx(d("WAWebBaseShimmerComponents.react").RectangleShimmer,{height:20,width:66,xstyle:d("WAWebUISpacing").uiMargin.bottom8})]})}b.displayName=b.name+" [from "+f.id+"]";g.NewsletterRecommendedItem=a;g.NewsletterRecommendedItemShimmer=b}),98);